<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>编写更复杂的窗口</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="npyscreen.html">npyscreen</a></p>

<ol>
<li><a href="npyscreen--npyscreen介绍.html">npyscreen介绍</a></li>
<li><a href="npyscreen--创建npyscreen应用程序.html">创建npyscreen应用程序</a></li>
<li><a href="npyscreen--Application应用对象.html">Application应用对象</a></li>
<li><a href="npyscreen--Form窗口对象.html">Form窗口对象</a></li>
<li><a href="npyscreen--控件基本特性.html">控件:基本特性</a></li>
<li><a href="npyscreen--控件显示文本.html">控件:显示文本</a></li>
<li><a href="npyscreen--控件选取选项.html">控件:选取选项</a></li>
<li><a href="npyscreen--控件树表与树的显示.html">控件:树表与树的显示</a></li>
<li><a href="npyscreen--控件日期,滑块和复合控件.html">控件:日期,滑块和复合控件</a></li>
<li><a href="npyscreen--控件网格.html">控件:网格</a></li>
<li><a href="npyscreen--控件其他控制.html">控件:其他控制</a></li>
<li><a href="npyscreen--控件标题控件.html">控件:标题控件</a></li>
<li><a href="npyscreen--控件控件框.html">控件:控件框</a></li>
<li><a href="npyscreen--按键绑定全解.html">按键绑定全解</a></li>
<li><a href="npyscreen--增强鼠标支持.html">增强鼠标支持</a></li>
<li><a href="npyscreen--色彩支持.html">色彩支持</a></li>
<li><a href="npyscreen--显示简讯通知及选项.html">显示简讯通知及选项</a></li>
<li><a href="npyscreen--清空屏幕.html">清空屏幕</a></li>
<li><a href="npyscreen--应用支持.html">应用支持</a></li>
<li><a href="npyscreen--编写更复杂的窗口.html">编写更复杂的窗口</a></li>
<li><a href="npyscreen--编写测试.html">编写测试</a></li>
<li><a href="npyscreen--示例程序一个简单的通讯录.html">示例程序:一个简单的通讯录</a></li>
</ol></div>
<div class="page"><h1><b><u>编写更复杂的窗口</u></b></h1><strong><h2>编写更复杂的窗口</h2></strong><br /><br />曾经的一个非常典型的终端应用的编程风格就是,有个命令行的屏幕,命令行一般在屏幕的底部,然后还有一些某种些列表控件或者其他显示控件占据屏幕的大部分,带一个顶部标题栏和一个命令行上面的状态栏.这种方案的变种可以在像 Mutt, less, Vim, irssi 等等这样的应用上找到.<br /><br />为了让写这种窗口更容易, npyscreen提供了一系列旨在协同工作的类.<br /><br />FormMuttActive, FormMuttActiveWithMenus, FormMuttActiveTraditional, FormMuttActiveTraditionalWithMenus<br />----这些类定义了基本的窗口.下面的类属性描述了这个具体这个窗口是如何被创建的:<br />----<div class="codebox"><div class="codebox">MAIN_WIDGET_CLASS&nbsp;&nbsp;&nbsp;=&nbsp;wgmultiline.MultiLine<br />MAIN_WIDGET_CLASS_START_LINE&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">1</span><br />STATUS_WIDGET_CLASS&nbsp;=&nbsp;wgtextbox.Textfield<br />STATUS_WIDGET_X_OFFSET&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">0</span><br />COMMAND_WIDGET_CLASS=&nbsp;wgtextbox.Textfield<br />COMMAND_WIDGET_NAME&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">None</span><br />COMMAND_WIDGET_BEGIN_ENTRY_AT&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">None</span><br />COMMAND_ALLOW_OVERRIDE_BEGIN_ENTRY_AT&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">True</span><br /><br />DATA_CONTROLER&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;npysNPSFilteredData.NPSFilteredDataList<br /><br />ACTION_CONTROLLER&nbsp;&nbsp;=&nbsp;ActionControllerSimple</div></div><br /><br />默认的定义使下面的实例属性在初始化后可用:<br />----<div class="codebox"><div class="codebox"><span style="color:#0000ff;font-weight:400">#&nbsp;Widgets&nbsp;-</span><br /><span style="color:#008a8c;font-weight:400">self</span>.wStatus1&nbsp;<span style="color:#0000ff;font-weight:400">#&nbsp;by&nbsp;default&nbsp;a&nbsp;title&nbsp;bar</span><br /><span style="color:#008a8c;font-weight:400">self</span>.wStatus2&nbsp;<span style="color:#0000ff;font-weight:400">#&nbsp;just&nbsp;above&nbsp;the&nbsp;command&nbsp;line</span><br /><span style="color:#008a8c;font-weight:400">self</span>.wMain&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;font-weight:400">#&nbsp;the&nbsp;main&nbsp;area&nbsp;of&nbsp;the&nbsp;form&nbsp;-&nbsp;by&nbsp;default&nbsp;a&nbsp;MultiLine&nbsp;object</span><br /><span style="color:#008a8c;font-weight:400">self</span>.wCommand&nbsp;<span style="color:#0000ff;font-weight:400">#&nbsp;the&nbsp;command&nbsp;widget</span><br /><br /><span style="color:#008a8c;font-weight:400">self</span>.action_controller&nbsp;<span style="color:#0000ff;font-weight:400">#&nbsp;not&nbsp;a&nbsp;widget.&nbsp;See&nbsp;below.</span></div></div><br />----窗口的 .value 属性是通过 DATA_CONTROLLER 来设定到类的实例中的.<br />----基本上,应用程序都会想要定义自己的 DATA_CONTROLLER 和 ACTION_CONTROLLER.<br />----传统的和非传统的窗口的不同点是,在传统的窗口中,关注点一直都是命令行控件,尽管一些按键也会被传到 MAIN_WIDGET_CLASS -结果是,在用户的视角上,看起来就像他/她会同时在跟二者一起交互.<br /><br />TextCommandBox<br />----TextCommandBox看起来就像一个平常的文本框,除了它会将用户键入的内容传递给 action_controller.它可以保留一个键入的命令的历史.更多细节参见 ActionControllerSimple 相关文档.<br /><br />TextCommandBoxTraditional<br />----这个跟 TextCommandBox 相同,只是它额外的传递某些击键动作到 self.linked_widget 指定[链接到]的控件中.在默认情况下,任何不匹配TextCommandBoxTraditional 中 handler操作器里的击键动作都会被传递到 [linked_widget]链接的控件中.此外,任何在 self.always_pass_to_linked_widget中列出的击键动作都会由链接的控件处理.不过,如果当前的命令行以任何 BEGINNING_OF_COMMAND_LINE_CHARS 类属性列出的字符开头的话,用户的输入将会由这个类处理,而不是链接的控件.<br />----这是相当复杂的,但是举个栗子会这更清楚一些.默认 BEGINNING_OF_COMMAND_LINE_CHARS 指定 ':' 或 '/' 标记命令的开始.在这个标记点之后,按键由这个控件处理而不是链接的控件,所以上下箭头开始操纵命令历史.不过如果命令历史是空的,这些按键就会操纵链接的控件.<br />----在 TextCommandBox控件中,命令行的值被传递到父级窗口的 action_controller对象中.<br /><br />ActionControllerSimple<br />----这个对象接收命令行和可执行回调函数.<br />----他识别两种类型的命令行 -一种"实时"命令行,在每次命令行改变都会发起操作[类似于vim],一种在回车键按下后执行的命令[类似标准命令行].<br />----回调函数使用 add_action(ident, function, live)方法添加. 'ident'是一个匹配命令行的正则表达式, function是回调函数自身, live要么是 True,要么是 False,来指定回调函数是否会伴随每次按键执行(假设 'ident'匹配).<br />----命令行匹配 'ident'正则表达式会导致回调函数以下面的参数被调用: call_back(command_line, control_widget_proxy, live=True).这里 command_line是一个命令行的字符串, control_widget_proxy是一个命令行控件的弱引用,而 live指定了函数是'实时'被调用还是作为一个返回结果.<br />----create()方法可以被覆盖.它在对象被创建时被调用.默认什么也不做.你可能会想用它作为调用 self.add_action的地方.<br /><br />NPSFilterDataBase<br />----默认的 NPSFilteredDataBase 类展示了管理显示的代码是怎么被分离出来到一个独立的对象里面的.具体的方法会非常依赖具体程序状况.这个也不是这种应用程序的一个基本部分,但是把(例如)数据库访问逻辑独立于用户界面逻辑单独存放是一种良好的实践.<br /><br /><strong><h3>示例代码</h3></strong><br /><br />下面的例子展示了这个模型是怎么工作的.这个应用创建了一个有搜索动作的 ActionController.这个动作调用用户自定义的 set_search函数,它会和父级窗口的 .value (实际上是一个 NPSFilteredDataBase 类)进行沟通.它之后用这个类设定 wMain.values 的值并调用 wMain.display()来更新屏幕显示.<br /><br />FmSearchActive 只是一个 FormMuttActiveTraditional 类,它带了一个[ACTION_CONTROLLER]类属性,该类属性指定了窗口要用的是我们定义的动作控制器:<br /><div class="codebox"><div class="codebox">class&nbsp;ActionControllerSearch(npyscreen.ActionControllerSimple):<br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;create(<span style="color:#008a8c;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.add_action(<span style="color:#ff00ff;font-weight:400">'^/.*'</span>,&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.set_search,&nbsp;<span style="color:#ff00ff;font-weight:400">True</span>)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;set_search(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;command_line,&nbsp;widget_proxy,&nbsp;live):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parent.value.set_filter(command_line[<span style="color:#ff00ff;font-weight:400">1</span>:])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parent.wMain.values&nbsp;=&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parent.value.get()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parent.wMain.display()<br /><br /><br />class&nbsp;FmSearchActive(npyscreen.FormMuttActiveTraditional):<br />&nbsp;&nbsp;&nbsp;&nbsp;ACTION_CONTROLLER&nbsp;=&nbsp;ActionControllerSearch<br /><br />class&nbsp;TestApp(npyscreen.NPSApp):<br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;main(<span style="color:#008a8c;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F&nbsp;=&nbsp;FmSearchActive()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F.wStatus1.value&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"Status&nbsp;Line&nbsp;"</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F.wStatus2.value&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"Second&nbsp;Status&nbsp;Line&nbsp;"</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F.value.set_values([str(x)&nbsp;for&nbsp;x&nbsp;in&nbsp;range(<span style="color:#ff00ff;font-weight:400">500</span>)])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F.wMain.values&nbsp;=&nbsp;F.value.get()<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F.edit()<br /><br /><br />if&nbsp;<span style="color:#008a8c;font-weight:400">__name__</span>&nbsp;==&nbsp;<span style="color:#ff00ff;font-weight:400">"__main__"</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;App&nbsp;=&nbsp;TestApp()<br />&nbsp;&nbsp;&nbsp;&nbsp;App.run()<br /></div></div><br /><br /></div></div>
</body></html>