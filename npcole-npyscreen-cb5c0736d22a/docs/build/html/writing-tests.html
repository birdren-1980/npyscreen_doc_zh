

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing Tests &mdash; npyscreen 中文手册 2 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="Example Application: A simple address book" href="example-addressbk.html" />
    <link rel="prev" title="Writing More Complex Forms" href="muttlike.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> npyscreen 中文手册
          

          
          </a>

          
            
            
              <div class="version">
                2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">npyscreen简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="application-structure.html">创建npyscreen应用程序</a></li>
<li class="toctree-l1"><a class="reference internal" href="application-objects.html">应用对象</a></li>
<li class="toctree-l1"><a class="reference internal" href="application-objects.html#id5">其他应用类</a></li>
<li class="toctree-l1"><a class="reference internal" href="form-objects.html">Form Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets.html">Widgets: Basic Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-text.html">Widgets: Displaying Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-multiline.html">Widgets: Picking Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-trees.html">Widgets: Trees and Tree displays</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-general.html">Widgets: Dates, Sliders and Combination Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-general.html#widgets-grids">Widgets: Grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-general.html#widgets-other-controls">Widgets: Other Controls</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-title.html">Widgets: Titled Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-title.html#widgets-box-widgets">Widgets: Box Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="keybindings.html">All about Key Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="mouse.html">Enhancing Mouse Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="color.html">Support for Colour</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html">Displaying Brief Messages and Choices</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html#blanking-the-screen">Blanking the Screen</a></li>
<li class="toctree-l1"><a class="reference internal" href="options.html">Application Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="muttlike.html">Writing More Complex Forms</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing Tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#convenience-functions-new-in-version-4-8-5">Convenience Functions (new in version 4.8.5)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preventing-forking-for-writing-unittests">Preventing Forking for writing unittests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example-addressbk.html">Example Application: A simple address book</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">npyscreen 中文手册</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Writing Tests</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/writing-tests.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-tests">
<h1>Writing Tests<a class="headerlink" href="#writing-tests" title="永久链接至标题">¶</a></h1>
<p>(New in version 4.7.0)</p>
<p>It is possible to script npyscreen application keyboard input for the purposes of testing.</p>
<p>The npyscreen module exports the following dictionary containing the relevant settings:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_SETTINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;TEST_INPUT&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;TEST_INPUT_LOG&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;CONTINUE_AFTER_TEST_INPUT&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;INPUT_GENERATOR&#39;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>If ‘TEST_INPUT’ is None the application progresses normally.  If it is an array, keystrokes are loaded from the left hand side of the array and fed to the application in place of getting input from the keyboard.  Note that special characters such as <em>curses.KEYDOWN</em> can be handled, and control characters can be indicated by a string such as <em>“^X”</em>.</p>
<p>A keypress that is fed to the application in this way is automatically appended to <em>‘TEST_INPUT_LOG’</em>, so it is possible to see where an error occurred when handling input.</p>
<p>If ‘CONTINUE_AFTER_TEST_INPUT’ is true, then after the automatic input has been specified, <em>‘TEST_INPUT’</em> is set to <em>None</em> and the application continues normally.  If it is False, then the exception <em>ExhaustedTestInput</em> is raised instead.  This would allow a unittest to then test the state of the application.</p>
<p>‘INPUT_GENERATOR’ can be set to an iterable object.  Each keypress will be read by calling <cite>next(INPUT_GENERATOR)</cite>.  Provided the iterable object chosen is thread-safe, this makes it easy to use one thread to feed the test input.  This can be used in preference to TEST_INPUT.  New in Version 4.9 and added at user request.</p>
<div class="section" id="convenience-functions-new-in-version-4-8-5">
<h2>Convenience Functions (new in version 4.8.5)<a class="headerlink" href="#convenience-functions-new-in-version-4-8-5" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt id="npyscreen.add_test_input_from_iterable">
<code class="sig-prename descclassname">npyscreen.</code><code class="sig-name descname">add_test_input_from_iterable</code><span class="sig-paren">(</span><em class="sig-param">iterable</em><span class="sig-paren">)</span><a class="headerlink" href="#npyscreen.add_test_input_from_iterable" title="永久链接至目标">¶</a></dt>
<dd><p>Add each item of <cite>iterable</cite> to <cite>TEST_SETTINGS[‘TEST_INPUT’]</cite>.</p>
</dd></dl>

<dl class="function">
<dt id="npyscreen.add_test_input_ch">
<code class="sig-prename descclassname">npyscreen.</code><code class="sig-name descname">add_test_input_ch</code><span class="sig-paren">(</span><em class="sig-param">ch</em><span class="sig-paren">)</span><a class="headerlink" href="#npyscreen.add_test_input_ch" title="永久链接至目标">¶</a></dt>
<dd><p>Add <cite>ch</cite> to <cite>TEST_SETTINGS[‘TEST_INPUT’]</cite>.</p>
</dd></dl>

</div>
<div class="section" id="preventing-forking-for-writing-unittests">
<h2>Preventing Forking for writing unittests<a class="headerlink" href="#preventing-forking-for-writing-unittests" title="永久链接至标题">¶</a></h2>
<p>In order to avoid a memory leak in the underlying curses module, the npyscreen library sometimes chooses to run the application code in a forked process.  For testing purposes this is usually undesirable, and you probably want to pass <cite>fork=False</cite> to the <cite>run()</cite> method of your application for testing purposes.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="永久链接至标题">¶</a></h2>
<p>The following is a trivial example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">curses</span>
<span class="kn">import</span> <span class="nn">npyscreen</span>

<span class="n">npyscreen</span><span class="o">.</span><span class="n">TEST_SETTINGS</span><span class="p">[</span><span class="s1">&#39;TEST_INPUT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s1">&#39;This is a test&#39;</span><span class="p">]</span>
<span class="n">npyscreen</span><span class="o">.</span><span class="n">TEST_SETTINGS</span><span class="p">[</span><span class="s1">&#39;TEST_INPUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curses</span><span class="o">.</span><span class="n">KEY_DOWN</span><span class="p">)</span>
<span class="n">npyscreen</span><span class="o">.</span><span class="n">TEST_SETTINGS</span><span class="p">[</span><span class="s1">&#39;CONTINUE_AFTER_TEST_INPUT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">TestForm</span><span class="p">(</span><span class="n">npyscreen</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myTitleText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">npyscreen</span><span class="o">.</span><span class="n">TitleText</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Events (Form Controlled):&quot;</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TestApp</span><span class="p">(</span><span class="n">npyscreen</span><span class="o">.</span><span class="n">StandardApp</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">onStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addForm</span><span class="p">(</span><span class="s2">&quot;MAIN&quot;</span><span class="p">,</span> <span class="n">TestForm</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">TestApp</span><span class="p">()</span>
    <span class="n">A</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fork</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># &#39;This is a test&#39; will appear in the first widget, as if typed by the user.</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example-addressbk.html" class="btn btn-neutral float-right" title="Example Application: A simple address book" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="muttlike.html" class="btn btn-neutral float-left" title="Writing More Complex Forms" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Nicholas Cole

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>