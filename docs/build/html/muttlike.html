

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing More Complex Forms &mdash; npyscreen 中文手册 2 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="Writing Tests" href="writing-tests.html" />
    <link rel="prev" title="Application Support" href="options.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> npyscreen 中文手册
          

          
          </a>

          
            
            
              <div class="version">
                2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">npyscreen简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="application-structure.html">创建npyscreen应用程序</a></li>
<li class="toctree-l1"><a class="reference internal" href="application-objects.html">应用对象</a></li>
<li class="toctree-l1"><a class="reference internal" href="application-objects.html#id5">其他应用类</a></li>
<li class="toctree-l1"><a class="reference internal" href="form-objects.html">Form Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets.html">Widgets: Basic Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-text.html">Widgets: Displaying Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-multiline.html">Widgets: Picking Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-trees.html">Widgets: Trees and Tree displays</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-general.html">Widgets: Dates, Sliders and Combination Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-general.html#widgets-grids">Widgets: Grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-general.html#widgets-other-controls">Widgets: Other Controls</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-title.html">Widgets: Titled Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets-title.html#widgets-box-widgets">Widgets: Box Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="keybindings.html">All about Key Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="mouse.html">Enhancing Mouse Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="color.html">Support for Colour</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html">Displaying Brief Messages and Choices</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html#blanking-the-screen">Blanking the Screen</a></li>
<li class="toctree-l1"><a class="reference internal" href="options.html">Application Support</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing More Complex Forms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-code">Example Code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="writing-tests.html">Writing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-addressbk.html">Example Application: A simple address book</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">npyscreen 中文手册</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Writing More Complex Forms</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/muttlike.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-more-complex-forms">
<h1>Writing More Complex Forms<a class="headerlink" href="#writing-more-complex-forms" title="永久链接至标题">¶</a></h1>
<p>A very typical style of programming for terminal applications has been to have a screen that has a command line, typically at the bottom of the screen, and then some kind of list widget or other display taking up most of the screen, with a title bar at the top and a status bar above the command line.  Variations on this scheme are found in applications like Mutt, less, Vim, irssi and so on.</p>
<p>To make writing these kinds of form easier, npyscreen provides a series of classes that are intended to work together.</p>
<dl>
<dt>FormMuttActive, FormMuttActiveWithMenus, FormMuttActiveTraditional, FormMuttActiveTraditionalWithMenus</dt><dd><p>These classes define the basic form.  The following <em>class attributes</em> dictate exactly how the form is created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MAIN_WIDGET_CLASS</span>   <span class="o">=</span> <span class="n">wgmultiline</span><span class="o">.</span><span class="n">MultiLine</span>
<span class="n">MAIN_WIDGET_CLASS_START_LINE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">STATUS_WIDGET_CLASS</span> <span class="o">=</span> <span class="n">wgtextbox</span><span class="o">.</span><span class="n">Textfield</span>
<span class="n">STATUS_WIDGET_X_OFFSET</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">COMMAND_WIDGET_CLASS</span><span class="o">=</span> <span class="n">wgtextbox</span><span class="o">.</span><span class="n">Textfield</span>
<span class="n">COMMAND_WIDGET_NAME</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">COMMAND_WIDGET_BEGIN_ENTRY_AT</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">COMMAND_ALLOW_OVERRIDE_BEGIN_ENTRY_AT</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">DATA_CONTROLER</span>    <span class="o">=</span> <span class="n">npysNPSFilteredData</span><span class="o">.</span><span class="n">NPSFilteredDataList</span>

<span class="n">ACTION_CONTROLLER</span>  <span class="o">=</span> <span class="n">ActionControllerSimple</span>
</pre></div>
</div>
<p>The default definition makes the following instance attributes available after initalization:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Widgets -</span>
<span class="bp">self</span><span class="o">.</span><span class="n">wStatus1</span> <span class="c1"># by default a title bar</span>
<span class="bp">self</span><span class="o">.</span><span class="n">wStatus2</span> <span class="c1"># just above the command line</span>
<span class="bp">self</span><span class="o">.</span><span class="n">wMain</span>    <span class="c1"># the main area of the form - by default a MultiLine object</span>
<span class="bp">self</span><span class="o">.</span><span class="n">wCommand</span> <span class="c1"># the command widget</span>

<span class="bp">self</span><span class="o">.</span><span class="n">action_controller</span> <span class="c1"># not a widget. See below.</span>
</pre></div>
</div>
<p>The form’s <em>.value</em> attribute is set to an instance of the object specified by DATA_CONTROLLER.</p>
<p>Typically, and application will want to define its own DATA_CONTROLLER and ACTION_CONTROLLER.</p>
<p>The difference between the traditional and non-traditional forms is that in the traditional form, the focus stays always with the command line widget, although some keypresses will be passed to the MAIN_WIDGET_CLASS - so that, from the user’s point of view, it looks as if he/she is interacting with both at once.</p>
</dd>
<dt>TextCommandBox</dt><dd><p>The TextCommandBox is like a usual text box, except that it passes what the user types to the action_controller.  In addition, it can keep a history of the commands entered.  See the documentation on ActionControllerSimple for more details.</p>
</dd>
<dt>TextCommandBoxTraditional</dt><dd><p>This is the same as the TextCommandBox, except that it additionally will pass certain keystrokes to the widget specified by <em>self.linked_widget</em>.  In the default case, any keystroke that does not match a handler in TextCommandBoxTraditional will be passed to the linked widget.  Additionally, any keystroke that is listed in the list <em>self.always_pass_to_linked_widget</em> will be handled by the linked widget.  However, if the current command line begins with any character that is listed in the class attribute <em>BEGINNING_OF_COMMAND_LINE_CHARS</em>, the user input will be handled by this class, not by the linked widget.</p>
<p>This is rather complicated, but an example will make it clearer.  The default BEGINNING_OF_COMMAND_LINE_CHARS specifies that ‘:’ or ‘/’ marks the beginning of a command.  After that point, keypresses are handled by this widget, not by the linked widget, so that the up and down arrows start to navigate the command history.  However, if the command line is currently empty, those keys navigate instead the linked widget.</p>
<p>As in the TextCommandBox widget, the value of the command line is passed to the parent form’s action_controller object.</p>
</dd>
<dt>ActionControllerSimple</dt><dd><p>This object receives command lines and executes call-back functions.</p>
<p>It recognises two types of command line - a “live” command line, where an action is taken with every change in the command line, and a command that is executed when the return key is pressed.</p>
<p>Callbacks are added using the <em>add_action(ident, function, live)</em>, method.  ‘ident’ is a regular expression that will be matched against the command line, <em>function</em> is the callback itself and <em>live</em> is either True or False, to specify whether the callback should be executed with every keypress (assuming that ‘ident’ matches).</p>
<p>Command lines that match the regular expression ‘ident’ cause the call-back to be called with the following arguments: <em>call_back(command_line, control_widget_proxy, live=True)</em>.  Here <em>command_line</em> is the string that is the command line, <em>control_widget_proxy</em> is a weak reference to the command line widget, and live specifies whether the function is being called ‘live’ or as a result of a return.</p>
<p>The method <em>create()</em> can be overridden. It is called when the object is created. The default does nothing.  You probably want to use this as a place to call <em>self.add_action</em>.</p>
</dd>
<dt>NPSFilteredDataBase</dt><dd><p>The default <em>NPSFilteredDataBase</em> class suggests how the code to manage the display might be separated out into a separate object.  The precise methods will be very application dependent.  This is not an essential part of this kind of application, but it is good practice to keep the logic of (for example) database access separate from the logic of the user interface.</p>
</dd>
</dl>
<div class="section" id="example-code">
<h2>Example Code<a class="headerlink" href="#example-code" title="永久链接至标题">¶</a></h2>
<p>The following example shows how this model works.  The application creates an ActionController that has a search action.  This action calls the user-defined function set_search, which communicates with the Form’s parent.value (actually a NPSFilteredDataBase class). It then uses this class to set the values in wMain.values and calls wMain.display() to update the display.</p>
<p>FmSearchActive is simply a FormMuttActiveTraditional class, with a class attribute that specifies that the form should use our action controller:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ActionControllerSearch</span><span class="p">(</span><span class="n">npyscreen</span><span class="o">.</span><span class="n">ActionControllerSimple</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="s1">&#39;^/.*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_search</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command_line</span><span class="p">,</span> <span class="n">widget_proxy</span><span class="p">,</span> <span class="n">live</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">set_filter</span><span class="p">(</span><span class="n">command_line</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">wMain</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">wMain</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">FmSearchActive</span><span class="p">(</span><span class="n">npyscreen</span><span class="o">.</span><span class="n">FormMuttActiveTraditional</span><span class="p">):</span>
    <span class="n">ACTION_CONTROLLER</span> <span class="o">=</span> <span class="n">ActionControllerSearch</span>

<span class="k">class</span> <span class="nc">TestApp</span><span class="p">(</span><span class="n">npyscreen</span><span class="o">.</span><span class="n">NPSApp</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">FmSearchActive</span><span class="p">()</span>
        <span class="n">F</span><span class="o">.</span><span class="n">wStatus1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;Status Line &quot;</span>
        <span class="n">F</span><span class="o">.</span><span class="n">wStatus2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;Second Status Line &quot;</span>
        <span class="n">F</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">set_values</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">)])</span>
        <span class="n">F</span><span class="o">.</span><span class="n">wMain</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="n">F</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">App</span> <span class="o">=</span> <span class="n">TestApp</span><span class="p">()</span>
    <span class="n">App</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="writing-tests.html" class="btn btn-neutral float-right" title="Writing Tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="options.html" class="btn btn-neutral float-left" title="Application Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Nicholas Cole

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>