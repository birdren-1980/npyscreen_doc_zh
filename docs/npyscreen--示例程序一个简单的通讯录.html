<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>示例程序:一个简单的通讯录</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="npyscreen.html">npyscreen</a></p>

<ol>
<li><a href="npyscreen--npyscreen介绍.html">npyscreen介绍</a></li>
<li><a href="npyscreen--创建npyscreen应用程序.html">创建npyscreen应用程序</a></li>
<li><a href="npyscreen--Application应用对象.html">Application应用对象</a></li>
<li><a href="npyscreen--Form窗口对象.html">Form窗口对象</a></li>
<li><a href="npyscreen--控件基本特性.html">控件:基本特性</a></li>
<li><a href="npyscreen--控件显示文本.html">控件:显示文本</a></li>
<li><a href="npyscreen--控件选取选项.html">控件:选取选项</a></li>
<li><a href="npyscreen--控件树表与树的显示.html">控件:树表与树的显示</a></li>
<li><a href="npyscreen--控件日期,滑块和复合控件.html">控件:日期,滑块和复合控件</a></li>
<li><a href="npyscreen--控件网格.html">控件:网格</a></li>
<li><a href="npyscreen--控件其他控制.html">控件:其他控制</a></li>
<li><a href="npyscreen--控件标题控件.html">控件:标题控件</a></li>
<li><a href="npyscreen--控件控件框.html">控件:控件框</a></li>
<li><a href="npyscreen--按键绑定全解.html">按键绑定全解</a></li>
<li><a href="npyscreen--增强鼠标支持.html">增强鼠标支持</a></li>
<li><a href="npyscreen--色彩支持.html">色彩支持</a></li>
<li><a href="npyscreen--显示简讯通知及选项.html">显示简讯通知及选项</a></li>
<li><a href="npyscreen--清空屏幕.html">清空屏幕</a></li>
<li><a href="npyscreen--应用支持.html">应用支持</a></li>
<li><a href="npyscreen--编写更复杂的窗口.html">编写更复杂的窗口</a></li>
<li><a href="npyscreen--编写测试.html">编写测试</a></li>
<li><a href="npyscreen--示例程序一个简单的通讯录.html">示例程序:一个简单的通讯录</a></li>
</ol></div>
<div class="page"><h1><b><u>示例程序:一个简单的通讯录</u></b></h1><strong><h2>实例程序:一个简单的通讯录</h2></strong><br /><br />一个通讯录程序需要一个数据库.为了方便,我们会用 sqlite.<br /><div class="codebox"><div class="codebox">class&nbsp;AddressDatabase(object):<br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;filename=<span style="color:#ff00ff;font-weight:400">"example-addressbook.db"</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.dbfilename&nbsp;=&nbsp;filename<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;=&nbsp;sqlite3.connect(<span style="color:#008a8c;font-weight:400">self</span>.dbfilename)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;db.cursor()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.execute(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff00ff;font-weight:400">"CREATE&nbsp;TABLE&nbsp;IF&nbsp;NOT&nbsp;EXISTS&nbsp;records\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;record_internal_id&nbsp;INTEGER&nbsp;PRIMARY&nbsp;KEY,&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT,&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other_names&nbsp;&nbsp;&nbsp;TEXT,&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;email_address&nbsp;TEXT&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)"</span>&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db.commit()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.close()<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;add_record(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;last_name&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">''</span>,&nbsp;other_names=<span style="color:#ff00ff;font-weight:400">''</span>,&nbsp;email_address=<span style="color:#ff00ff;font-weight:400">''</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;=&nbsp;sqlite3.connect(<span style="color:#008a8c;font-weight:400">self</span>.dbfilename)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;db.cursor()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.execute(<span style="color:#ff00ff;font-weight:400">'INSERT&nbsp;INTO&nbsp;records(last_name,&nbsp;other_names,&nbsp;email_address)&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES(?,?,?)'</span>,&nbsp;(last_name,&nbsp;other_names,&nbsp;email_address))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db.commit()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.close()<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;update_record(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;record_id,&nbsp;last_name&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">''</span>,&nbsp;other_names=<span style="color:#ff00ff;font-weight:400">''</span>,&nbsp;email_address=<span style="color:#ff00ff;font-weight:400">''</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;=&nbsp;sqlite3.connect(<span style="color:#008a8c;font-weight:400">self</span>.dbfilename)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;db.cursor()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.execute(<span style="color:#ff00ff;font-weight:400">'UPDATE&nbsp;records&nbsp;set&nbsp;last_name=?,&nbsp;other_names=?,&nbsp;email_address=?&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;record_internal_id=?'</span>,&nbsp;(last_name,&nbsp;other_names,&nbsp;email_address,&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;record_id))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db.commit()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.close()<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;delete_record(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;record_id):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;=&nbsp;sqlite3.connect(<span style="color:#008a8c;font-weight:400">self</span>.dbfilename)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;db.cursor()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.execute(<span style="color:#ff00ff;font-weight:400">'DELETE&nbsp;FROM&nbsp;records&nbsp;where&nbsp;record_internal_id=?'</span>,&nbsp;(record_id,))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db.commit()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.close()<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;list_all_records(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;=&nbsp;sqlite3.connect(<span style="color:#008a8c;font-weight:400">self</span>.dbfilename)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;db.cursor()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.execute(<span style="color:#ff00ff;font-weight:400">'SELECT&nbsp;*&nbsp;from&nbsp;records'</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;records&nbsp;=&nbsp;c.fetchall()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.close()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;records<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;get_record(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;record_id):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;=&nbsp;sqlite3.connect(<span style="color:#008a8c;font-weight:400">self</span>.dbfilename)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;db.cursor()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.execute(<span style="color:#ff00ff;font-weight:400">'SELECT&nbsp;*&nbsp;from&nbsp;records&nbsp;WHERE&nbsp;record_internal_id=?'</span>,&nbsp;(record_id,))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;records&nbsp;=&nbsp;c.fetchall()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.close()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;records[<span style="color:#ff00ff;font-weight:400">0</span>]</div></div><br /><br />这个应用程序的主屏幕会是一个名字的列表.当用户选择一个名字,我们会想要编辑它.我们会子类化 MultiLineAction,然后覆盖 display_value方法来改变每个记录是怎么展示的.我们还会重写 actionHightlighted方法来在需要的时候转换到编辑状态.最后,我们会添加两个新的 keypress -一个用来添加一个用来删除记录.在切换到 EDITRECORDFM之前,我们要么设置它的值为 None,如果在创建新窗口的话,要么设置成我们希望编辑的记录的值.<br /><div class="codebox"><div class="codebox">class&nbsp;RecordList(npyscreen.MultiLineAction):<br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;*args,&nbsp;**keywords):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(RecordList,&nbsp;<span style="color:#008a8c;font-weight:400">self</span>).__init__(*args,&nbsp;**keywords)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.add_handlers({<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff00ff;font-weight:400">"^A"</span>:&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.when_add_record,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff00ff;font-weight:400">"^D"</span>:&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.when_delete_record<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;display_value(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;vl):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:#ff00ff;font-weight:400">"%s,&nbsp;%s"</span>&nbsp;%&nbsp;(vl[<span style="color:#ff00ff;font-weight:400">1</span>],&nbsp;vl[<span style="color:#ff00ff;font-weight:400">2</span>])<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;actionHighlighted(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;act_on_this,&nbsp;keypress):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parent.parentApp.getForm(<span style="color:#ff00ff;font-weight:400">'EDITRECORDFM'</span>).value&nbsp;=act_on_this[<span style="color:#ff00ff;font-weight:400">0</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parent.parentApp.switchForm(<span style="color:#ff00ff;font-weight:400">'EDITRECORDFM'</span>)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;when_add_record(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;*args,&nbsp;**keywords):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parent.parentApp.getForm(<span style="color:#ff00ff;font-weight:400">'EDITRECORDFM'</span>).value&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">None</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parent.parentApp.switchForm(<span style="color:#ff00ff;font-weight:400">'EDITRECORDFM'</span>)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;when_delete_record(<span style="color:#008a8c;font-weight:400">self</span>,&nbsp;*args,&nbsp;**keywords):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parent.parentApp.myDatabase.delete_record(<span style="color:#008a8c;font-weight:400">self</span>.values[<span style="color:#008a8c;font-weight:400">self</span>.cursor_line][<span style="color:#ff00ff;font-weight:400">0</span>])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parent.update_list()</div></div><br /><br />实际上用来显示记录列表的窗口会是一个 FormMutt 子类.我们会修改 MAIN_WIDGET_CLASS类变量来使用我们自己的 RecordList控件,然后确保每一次窗口展示给用户的时候记录列表都是最新的.<br /><div class="codebox"><div class="codebox">class&nbsp;RecordListDisplay(npyscreen.FormMutt):<br />&nbsp;&nbsp;&nbsp;&nbsp;MAIN_WIDGET_CLASS&nbsp;=&nbsp;RecordList<br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;beforeEditing(<span style="color:#008a8c;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.update_list()<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;update_list(<span style="color:#008a8c;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wMain.values&nbsp;=&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parentApp.myDatabase.list_all_records()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wMain.display()</div></div><br /><br />用来编辑每个记录的窗口会是一个 ActionForm的示例.记录只会在用户选择了 'OK'键之后才被修改.在窗口展示给用户之前,每一个独立控件的值都会更新到匹配数据库的记录,或者如果是创建一个新的记录的时候则会先清空.<br /><div class="codebox"><div class="codebox">class&nbsp;EditRecord(npyscreen.ActionForm):<br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;create(<span style="color:#008a8c;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.value&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">None</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgLastName&nbsp;&nbsp;&nbsp;=&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.add(npyscreen.TitleText,&nbsp;name&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"Last&nbsp;Name:"</span>,)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgOtherNames&nbsp;=&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.add(npyscreen.TitleText,&nbsp;name&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"Other&nbsp;Names:"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgEmail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.add(npyscreen.TitleText,&nbsp;name&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"Email:"</span>)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;beforeEditing(<span style="color:#008a8c;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.value:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;record&nbsp;=&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parentApp.myDatabase.get_record(<span style="color:#008a8c;font-weight:400">self</span>.value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.name&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"Record&nbsp;id&nbsp;:&nbsp;%s"</span>&nbsp;%&nbsp;record[<span style="color:#ff00ff;font-weight:400">0</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.record_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;record[<span style="color:#ff00ff;font-weight:400">0</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgLastName.value&nbsp;&nbsp;&nbsp;=&nbsp;record[<span style="color:#ff00ff;font-weight:400">1</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgOtherNames.value&nbsp;=&nbsp;record[<span style="color:#ff00ff;font-weight:400">2</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgEmail.value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;record[<span style="color:#ff00ff;font-weight:400">3</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.name&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"New&nbsp;Record"</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.record_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">''</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgLastName.value&nbsp;&nbsp;&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">''</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgOtherNames.value&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">''</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgEmail.value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">''</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;on_ok(<span style="color:#008a8c;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.record_id:&nbsp;<span style="color:#0000ff;font-weight:400">#&nbsp;We&nbsp;are&nbsp;editing&nbsp;an&nbsp;existing&nbsp;record</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parentApp.myDatabase.update_record(<span style="color:#008a8c;font-weight:400">self</span>.record_id,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_name=<span style="color:#008a8c;font-weight:400">self</span>.wgLastName.value,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other_names&nbsp;=&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgOtherNames.value,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;email_address&nbsp;=&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgEmail.value,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;<span style="color:#0000ff;font-weight:400">#&nbsp;We&nbsp;are&nbsp;adding&nbsp;a&nbsp;new&nbsp;record.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parentApp.myDatabase.add_record(last_name=<span style="color:#008a8c;font-weight:400">self</span>.wgLastName.value,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other_names&nbsp;=&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgOtherNames.value,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;email_address&nbsp;=&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.wgEmail.value,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parentApp.switchFormPrevious()<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;on_cancel(<span style="color:#008a8c;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.parentApp.switchFormPrevious()</div></div><br /><br />最终,我们需要一个能管理两个窗口和数据库的应用对象:<br /><div class="codebox"><div class="codebox">class&nbsp;AddressBookApplication(npyscreen.NPSAppManaged):<br />&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;onStart(<span style="color:#008a8c;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.myDatabase&nbsp;=&nbsp;AddressDatabase()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.addForm(<span style="color:#ff00ff;font-weight:400">"MAIN"</span>,&nbsp;RecordListDisplay)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008a8c;font-weight:400">self</span>.addForm(<span style="color:#ff00ff;font-weight:400">"EDITRECORDFM"</span>,&nbsp;EditRecord)<br /><br />if&nbsp;<span style="color:#008a8c;font-weight:400">__name__</span>&nbsp;==&nbsp;<span style="color:#ff00ff;font-weight:400">'__main__'</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;myApp&nbsp;=&nbsp;AddressBookApplication()<br />&nbsp;&nbsp;&nbsp;&nbsp;myApp.run()</div></div><br /><br /></div></div>
</body></html>